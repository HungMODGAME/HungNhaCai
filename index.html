<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T√†i X·ªâu Live - Pro</title>
    <style>
        :root { --gold: #f1c40f; --red: #e74c3c; --green: #2ecc71; --bg: #0d0d0d; --card: #1a1a1a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; outline: none; user-select: none; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }

        /* Auth Screen */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: #1a1a1a; width: 100%; max-width: 350px; padding: 25px; border-radius: 15px; border: 1px solid #333; text-align: center; }

        /* Header */
        .header { background: #111; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--gold); }
        .user-icon { width: 40px; height: 40px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid var(--gold); font-size: 1.2rem; }
        .balance-box { color: var(--gold); font-weight: bold; font-family: monospace; font-size: 1.1rem; }

        /* Sidebar */
        .sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: #1a1a1a; z-index: 2000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 20px; border-right: 1px solid #333; }
        .sidebar.active { left: 0; }
        .menu-item { padding: 15px; background: #222; margin-bottom: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: bold; }
        .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1999; }

        /* Game Main */
        .game-container { width: 100%; max-width: 450px; height: 100vh; margin: 0 auto; display: flex; flex-direction: column; position: relative; }
        #timer { font-size: 5rem; color: var(--red); font-weight: 900; text-align: center; font-family: monospace; }
        #status-msg { font-size: 1rem; font-weight: bold; height: 40px; text-align: center; text-transform: uppercase; display: flex; align-items: center; justify-content: center; }

        .plate-area { position: relative; width: 230px; height: 230px; background: #fff; border-radius: 50%; margin: 15px auto; border: 10px solid #2c3e50; display: flex; justify-content: center; align-items: center; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .dice { width: 45px; height: 45px; background: white; color: black; line-height: 45px; font-weight: bold; font-size: 2.2rem; border: 2px solid #000; margin: 0 3px; border-radius: 8px; text-align: center; }
        #bowl { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 30% 30%, #555, #000); border-radius: 50%; z-index: 10; cursor: grab; }

        .btn-soicau { position: absolute; bottom: 200px; right: 20px; width: 50px; height: 50px; background: #222; border-radius: 50%; border: 2px solid var(--gold); color: var(--gold); font-weight: bold; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; font-size: 0.7rem; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }

        .sc-container { width: 100%; background: #1a1a1a; border: 1px solid #444; border-radius: 10px; padding: 10px; position: relative; overflow-x: auto; }
        .sc-grid { position: relative; height: 150px; border-left: 1px solid #444; border-bottom: 1px solid #444; margin-top: 10px; display: flex; align-items: flex-end; padding: 0 10px; min-width: 300px; }
        .sc-line-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .sc-point { width: 12px; height: 12px; border-radius: 50%; position: absolute; transform: translate(-50%, 50%); z-index: 5; display: flex; align-items: center; justify-content: center; font-size: 8px; color: #000; font-weight: bold; border: 1px solid #fff; }

        .betting-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; flex: 1; }
        .bet-box { background: var(--card); border: 2px solid #222; border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 15px; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .bet-box.locked { opacity: 0.4; pointer-events: none; }
        .xiu-text { color: var(--red); font-size: 2.8rem; font-weight: 900; }
        .tai-text { color: var(--green); font-size: 2.8rem; font-weight: 900; }
        .my-bet-info { background: var(--gold); color: #000; font-size: 0.75rem; font-weight: bold; padding: 2px 8px; border-radius: 4px; display: none; position: absolute; bottom: 10px; }

        .popup { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; align-items: center; justify-content: center; padding: 20px; }
        .card { background: #1a1a1a; width: 100%; max-width: 400px; padding: 25px; border-radius: 15px; border: 1px solid #333; }
        input { width: 100%; padding: 12px; margin: 8px 0; background: #000; color: #fff; border: 1px solid #444; border-radius: 6px; }
        .btn { width: 100%; padding: 12px; border: none; font-weight: bold; border-radius: 6px; cursor: pointer; margin-top: 10px; text-transform: uppercase; }
        .btn-green { background: var(--green); color: white; }
        .btn-gray { background: #444; color: white; }
        .btn-red { background: var(--red); color: white; }

        .bet-selector { position: absolute; bottom: 0; left: 0; right: 0; background: #080808; padding: 20px; display: none; flex-direction: column; gap: 8px; z-index: 500; border-top: 3px solid var(--gold); }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card">
        <h2 style="color:var(--gold); margin-bottom:15px;">T√ÄI X·ªàU LIVE</h2>
        <input type="text" id="username-input" placeholder="T√™n t√†i kho·∫£n">
        <input type="password" id="password-input" placeholder="M·∫≠t kh·∫©u">
        <button class="btn btn-green" onclick="handleAuth('login')">ƒêƒÇNG NH·∫¨P</button>
        <button class="btn btn-gray" onclick="handleAuth('register')">ƒêƒÇNG K√ù (T·∫∂NG 10K)</button>
    </div>
</div>

<div class="popup" id="popup-giftcode">
    <div class="card">
        <h2 style="text-align:center; color:var(--gold)">NH·∫¨P GIFTCODE</h2>
        <input type="text" id="gc-input" placeholder="Nh·∫≠p m√£..." style="text-align:center; text-transform: uppercase;">
        <button class="btn btn-green" onclick="handleRedeem()">X√ÅC NH·∫¨N</button>
        <button class="btn btn-gray" onclick="closePopup('popup-giftcode')">ƒê√ìNG</button>
    </div>
</div>

<div class="popup" id="popup-soicau">
    <div class="card" style="max-width: 90%;">
        <h2 style="text-align:center; color:var(--gold); margin-bottom: 15px; font-size: 1.2rem;">SOI C·∫¶U T√ÄI X·ªàU</h2>
        <div class="sc-container">
            <div class="sc-grid" id="sc-grid">
                <canvas id="sc-canvas" class="sc-line-canvas"></canvas>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.6rem; color: #888;">
                <span>V√°n c≈©</span>
                <span>V√°n m·ªõi nh·∫•t</span>
            </div>
        </div>
        <button class="btn btn-gray" onclick="closePopup('popup-soicau')">ƒê√ìNG</button>
    </div>
</div>

<div class="game-container">
    <div class="header">
        <div class="user-icon" onclick="toggleSidebar()">üë§</div>
        <div class="balance-box">üí∞ <span id="balance-display">0</span></div>
    </div>

    <div id="timer">00</div>
    <div id="status-msg">M·ªùi S·∫øp C∆∞·ª£c</div>

    <div class="plate-area" id="plate">
        <div id="dice-wrap">
            <span class="dice">?</span><span class="dice">?</span><span class="dice">?</span>
        </div>
        <div id="bowl" style="display: none;"></div>
    </div>

    <div class="btn-soicau" onclick="openPopup('popup-soicau')">SOI<br>C·∫¶U</div>

    <div class="betting-grid">
        <div class="bet-box" id="box-xiu" onclick="openSelector('Xiu')">
            <div style="font-size: 0.7rem; color:#666;">üë§ <span id="p-xiu">0</span></div>
            <div class="xiu-text">X·ªàU</div>
            <div style="color:var(--gold); font-family:monospace;" id="total-xiu">0</div>
            <div class="my-bet-info" id="my-info-xiu"></div>
            <div class="bet-selector" id="sel-xiu">
                <div style="color:var(--gold); font-size:1.5rem; text-align:center; margin-bottom:10px;" id="disp-xiu">0</div>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px;">
                    <button class="btn btn-gray" onclick="addToTemp(1000000, event)">1M</button>
                    <button class="btn btn-gray" onclick="addToTemp(10000000, event)">10M</button>
                    <button class="btn btn-gray" onclick="addToTemp('all', event)">ALL</button>
                </div>
                <button class="btn btn-green" onclick="confirmBet(event)">X√ÅC NH·∫¨N</button>
                <button class="btn btn-red" onclick="cancelBet(event)">H·ª¶Y C∆Ø·ª¢C</button>
                <button class="btn btn-gray" onclick="closeSelector(event)">ƒê√ìNG</button>
            </div>
        </div>

        <div class="bet-box" id="box-tai" onclick="openSelector('Tai')">
            <div style="font-size: 0.7rem; color:#666;">üë§ <span id="p-tai">0</span></div>
            <div class="tai-text">T√ÄI</div>
            <div style="color:var(--gold); font-family:monospace;" id="total-tai">0</div>
            <div class="my-bet-info" id="my-info-tai"></div>
            <div class="bet-selector" id="sel-tai">
                <div style="color:var(--gold); font-size:1.5rem; text-align:center; margin-bottom:10px;" id="disp-tai">0</div>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px;">
                    <button class="btn btn-gray" onclick="addToTemp(1000000, event)">1M</button>
                    <button class="btn btn-gray" onclick="addToTemp(10000000, event)">10M</button>
                    <button class="btn btn-gray" onclick="addToTemp('all', event)">ALL</button>
                </div>
                <button class="btn btn-green" onclick="confirmBet(event)">X√ÅC NH·∫¨N</button>
                <button class="btn btn-red" onclick="cancelBet(event)">H·ª¶Y C∆Ø·ª¢C</button>
                <button class="btn btn-gray" onclick="closeSelector(event)">ƒê√ìNG</button>
            </div>
        </div>
    </div>
</div>

<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
    <div style="border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:15px;">
        <h3 id="side-username" style="color:var(--gold)">USER</h3>
        <p style="font-size:0.8rem; color:#777;">Th√†nh vi√™n VIP</p>
    </div>
    <div id="side-menu-content"></div>
</div>

<div class="popup" id="popup-withdraw">
    <div class="card" id="withdraw-form">
        <h2 style="text-align:center; color:var(--gold)">R√öT TI·ªÄN</h2>
        <input type="text" id="w-bank" placeholder="Ng√¢n h√†ng" list="bank-list">
        <datalist id="bank-list">
            <option value="Vietcombank"><option value="MB Bank">
        </datalist>
        <input type="text" id="w-stk" placeholder="S·ªë t√†i kho·∫£n">
        <input type="number" id="w-amt" placeholder="S·ªë ti·ªÅn r√∫t (T·ªëi thi·ªÉu 5M)">
        <button class="btn btn-green" onclick="startWithdraw()">G·ª¨I L·ªÜNH</button>
        <button class="btn btn-gray" onclick="closePopup('popup-withdraw')">ƒê√ìNG</button>
    </div>
</div>

<script>
    let currentUser = null;
    let myBet = { amount: 0, side: null };
    let tempAmt = 0;
    let currentResult = [1,1,1];
    let bowlOpened = false;
    let gameHistory = JSON.parse(localStorage.getItem('v6_history') || '[]');
    
    // L∆∞u bi·∫øn ƒë·ªÉ c·ªông d·ªìn ti·ªÅn c∆∞·ª£c ng∆∞·ªùi ch∆°i v√†o t·ªïng
    let fakeTotalXiu = 0;
    let fakeTotalTai = 0;

    function handleAuth(type) {
        const u = document.getElementById('username-input').value.trim();
        const p = document.getElementById('password-input').value.trim();
        if(!u || !p) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·ªß!");
        let users = JSON.parse(localStorage.getItem('v6_users') || '{}');
        if(type === 'register') {
            if(users[u]) return alert("T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!");
            users[u] = { user: u, pass: p, balance: 10000, usedCodes: [] };
            localStorage.setItem('v6_users', JSON.stringify(users));
            alert("ƒêƒÉng k√Ω th√†nh c√¥ng! Nh·∫≠n 10k.");
        }
        if(users[u] && users[u].pass === p) {
            currentUser = users[u];
            if(!currentUser.usedCodes) currentUser.usedCodes = [];
            localStorage.setItem('v6_logged', u);
            document.getElementById('auth-screen').style.display = 'none';
        } else alert("Sai th√¥ng tin!");
    }

    function handleRedeem() {
        const codeInput = document.getElementById('gc-input').value.trim().toUpperCase();
        let giftcodes = JSON.parse(localStorage.getItem('v6_giftcodes') || '{}');
        if(!giftcodes[codeInput]) return alert("M√£ kh√¥ng t·ªìn t·∫°i!");
        let gc = giftcodes[codeInput];
        if(currentUser.usedCodes.includes(codeInput)) return alert("B·∫°n ƒë√£ nh·∫≠p m√£ n√†y r·ªìi!");
        if(gc.usedCount >= gc.limit) return alert("M√£ ƒë√£ h·∫øt l∆∞·ª£t!");
        currentUser.balance += gc.value;
        currentUser.usedCodes.push(codeInput);
        gc.usedCount += 1;
        giftcodes[codeInput] = gc;
        localStorage.setItem('v6_giftcodes', JSON.stringify(giftcodes));
        save(); updateBalanceUI(); alert("Th√†nh c√¥ng!"); closePopup('popup-giftcode');
    }

    function logout() { localStorage.removeItem('v6_logged'); location.reload(); }

    function gameLoop() {
        if(!currentUser) return;
        const now = Math.floor(Date.now() / 1000);
        const elapsed = now % 73;
        const status = document.getElementById('status-msg');

        if (elapsed < 60) {
            document.getElementById('timer').innerText = (60 - elapsed).toString().padStart(2, '0');
            if (elapsed === 0) {
                status.innerText = "M·ªúI S·∫æP C∆Ø·ª¢C"; status.style.color = "#fff";
                document.querySelectorAll('.dice').forEach(d => d.innerText = "?");
                document.getElementById('bowl').style.display = 'none';
                bowlOpened = false;
                fakeTotalXiu = 0; fakeTotalTai = 0; // Reset t·ªïng m·ªói v√°n
            }
            
            // NG∆ØNG C∆Ø·ª¢C KHI C√íN 5S
            if (60 - elapsed <= 5) {
                status.innerText = "NG·ª™NG NH·∫¨N C∆Ø·ª¢C"; status.style.color = "#e74c3c";
                document.getElementById('box-xiu').classList.add('locked');
                document.getElementById('box-tai').classList.add('locked');
                closeSelector();
                // Kh√¥ng g·ªçi updateFakeData n·ªØa ƒë·ªÉ gi·ªØ nguy√™n s·ªë ti·ªÅn
            } else {
                document.getElementById('box-xiu').classList.remove('locked');
                document.getElementById('box-tai').classList.remove('locked');
                updateFakeData(elapsed); // Ch·ªâ c·∫≠p nh·∫≠t ng∆∞·ªùi ·∫£o khi ch∆∞a ƒë·∫øn 5s cu·ªëi
            }
        } else if (elapsed < 70) {
            document.getElementById('timer').innerText = (70 - elapsed).toString().padStart(2, '0');
            if (!bowlOpened) {
                status.innerText = "VUI L√íNG N·∫∂N B√ÅT"; status.style.color = "#f1c40f";
                document.getElementById('bowl').style.display = 'block';
                if(elapsed === 60) {
                    currentResult = [Math.floor(Math.random() * 6) + 1, Math.floor(Math.random() * 6) + 1, Math.floor(Math.random() * 6) + 1];
                    document.querySelectorAll('.dice').forEach((d, i) => d.innerText = currentResult[i]);
                }
            }
            if (elapsed === 69 && !bowlOpened) forceOpen();
        } else {
            document.getElementById('timer').innerText = "00";
            if (elapsed === 72) { myBet = { amount: 0, side: null }; updateMyBetUI(); }
        }
        updateBalanceUI();
        renderSidebarMenu();
    }

    function updateBalanceUI() { document.getElementById('balance-display').innerText = currentUser.balance.toLocaleString(); }

    function updateFakeData(v) {
        const s = Math.floor(Date.now() / 73000);
        document.getElementById('p-xiu').innerText = (Math.floor(v*(s%10+55)) + 120).toLocaleString();
        document.getElementById('p-tai').innerText = (Math.floor(v*(s%8+50)) + 110).toLocaleString();
        
        // T√≠nh ti·ªÅn ·∫£o + ti·ªÅn c·ªßa m√¨nh ƒë√£ c∆∞·ª£c
        let myXiu = (myBet.side === 'Xiu') ? myBet.amount : 0;
        let myTai = (myBet.side === 'Tai') ? myBet.amount : 0;
        
        fakeTotalXiu = (Math.floor(v*1650000)) + myXiu;
        fakeTotalTai = (Math.floor(v*1580000)) + myTai;
        
        document.getElementById('total-xiu').innerText = fakeTotalXiu.toLocaleString();
        document.getElementById('total-tai').innerText = fakeTotalTai.toLocaleString();
    }

    function checkWin() {
        const total = currentResult.reduce((a, b) => a + b, 0);
        const winSide = total >= 11 ? 'Tai' : 'Xiu';
        gameHistory.push({side: winSide, total: total});
        if(gameHistory.length > 15) gameHistory.shift();
        localStorage.setItem('v6_history', JSON.stringify(gameHistory));
        const isBao = currentResult[0] === currentResult[1] && currentResult[1] === currentResult[2];
        if (myBet.side === winSide) {
            let win = isBao ? myBet.amount : Math.floor(myBet.amount * 0.96);
            currentUser.balance += (myBet.amount + win);
            document.getElementById('status-msg').innerText = "TH·∫ÆNG: +" + (myBet.amount + win).toLocaleString();
            document.getElementById('status-msg').style.color = "var(--green)";
        } else if (myBet.side) {
            document.getElementById('status-msg').innerText = "THUA C∆Ø·ª¢C";
            document.getElementById('status-msg').style.color = "var(--red)";
        }
        save();
    }

    function drawHistoryChart() {
        const grid = document.getElementById('sc-grid');
        const canvas = document.getElementById('sc-canvas');
        const ctx = canvas.getContext('2d');
        grid.querySelectorAll('.sc-point').forEach(p => p.remove());
        if (gameHistory.length === 0) return;
        const rect = grid.getBoundingClientRect();
        canvas.width = rect.width; canvas.height = rect.height;
        const stepX = canvas.width / 15; const stepY = canvas.height / 18;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath(); ctx.strokeStyle = '#f1c40f'; ctx.lineWidth = 2;
        gameHistory.forEach((data, i) => {
            const x = i * stepX + stepX/2; const y = canvas.height - (data.total * stepY);
            if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            const dot = document.createElement('div');
            dot.className = 'sc-point';
            dot.style.left = x + 'px'; dot.style.bottom = (data.total * stepY) + 'px';
            dot.style.background = data.side === 'Tai' ? 'var(--green)' : 'var(--red)';
            dot.innerText = data.total; grid.appendChild(dot);
        });
        ctx.stroke();
    }

    function renderSidebarMenu() {
        if(!currentUser) return;
        document.getElementById('side-username').innerText = currentUser.user.toUpperCase();
        document.getElementById('side-menu-content').innerHTML = `<div class="menu-item" onclick="openPopup('popup-withdraw')">üí∏ R√öT TI·ªÄN</div><div class="menu-item" onclick="openPopup('popup-giftcode')">üéÅ NH·∫¨N GIFTCODE</div><div class="menu-item" style="color:var(--red); margin-top:20px;" onclick="logout()">üö™ ƒêƒÇNG XU·∫§T</div>`;
    }

    function toggleSidebar() {
        const sb = document.getElementById('sidebar');
        sb.classList.toggle('active');
        document.getElementById('sidebar-overlay').style.display = sb.classList.contains('active') ? 'block' : 'none';
    }

    function openSelector(s) {
        const elapsed = Math.floor(Date.now() / 1000) % 73;
        if(60 - elapsed <= 5) return; // Kh√¥ng m·ªü ƒë∆∞·ª£c b·∫£ng c∆∞·ª£c ·ªü 5s cu·ªëi
        document.querySelectorAll('.bet-selector').forEach(el=>el.style.display='none');
        document.getElementById(`sel-${s.toLowerCase()}`).style.display='flex';
        tempAmt = 0; updateTempUI();
    }
    function addToTemp(v,e){ e.stopPropagation(); if(v==='all') tempAmt=currentUser.balance; else tempAmt+=v; updateTempUI(); }
    function updateTempUI(){ document.getElementById('disp-xiu').innerText = document.getElementById('disp-tai').innerText = tempAmt.toLocaleString(); }
    
    function confirmBet(e){ 
        e.stopPropagation(); 
        if(tempAmt<=0 || tempAmt>currentUser.balance) return;
        const s = document.getElementById('sel-xiu').style.display==='flex'?'Xiu':'Tai';
        
        currentUser.balance -= tempAmt; 
        myBet.amount += tempAmt;
        myBet.side = s;
        
        // C·∫¨P NH·∫¨T TR·ª∞C TI·∫æP V√ÄO T·ªîNG TI·ªÄN HI·ªÇN TH·ªä NGAY KHI C∆Ø·ª¢C
        if(s === 'Xiu') {
            fakeTotalXiu += tempAmt;
            document.getElementById('total-xiu').innerText = fakeTotalXiu.toLocaleString();
        } else {
            fakeTotalTai += tempAmt;
            document.getElementById('total-tai').innerText = fakeTotalTai.toLocaleString();
        }

        save(); updateMyBetUI(); closeSelector();
    }

    function cancelBet(e){ e.stopPropagation(); if(myBet.amount > 0){ currentUser.balance += myBet.amount; myBet.amount = 0; myBet.side = null; save(); updateMyBetUI(); alert("ƒê√£ h·ªßy c∆∞·ª£c!"); } closeSelector(); }
    function closeSelector(e){ if(e) e.stopPropagation(); document.querySelectorAll('.bet-selector').forEach(el=>el.style.display='none'); }
    function updateMyBetUI() {
        const x = document.getElementById('my-info-xiu'), t = document.getElementById('my-info-tai');
        x.style.display = (myBet.side==='Xiu' && myBet.amount > 0) ? 'block' : 'none';
        t.style.display = (myBet.side==='Tai' && myBet.amount > 0) ? 'block' : 'none';
        x.innerText = t.innerText = "C∆Ø·ª¢C: " + myBet.amount.toLocaleString();
    }
    function save(){ if(currentUser){ let u = JSON.parse(localStorage.getItem('v6_users')); u[currentUser.user]=currentUser; localStorage.setItem('v6_users', JSON.stringify(u)); } }
    function forceOpen() { bowlOpened = true; document.getElementById('bowl').style.display = 'none'; checkWin(); }
    function openPopup(id) { if(id === 'popup-soicau') setTimeout(drawHistoryChart, 100); else toggleSidebar(); document.getElementById(id).style.display = 'flex'; }
    function closePopup(id) { document.getElementById(id).style.display = 'none'; }

    const bowl = document.getElementById('bowl');
    let isDragging = false;
    bowl.onpointerdown = (e) => { isDragging = true; bowl.setPointerCapture(e.pointerId); };
    bowl.onpointermove = (e) => {
        if (!isDragging) return;
        const plate = document.getElementById('plate').getBoundingClientRect();
        let x = e.clientX - plate.left - 115, y = e.clientY - plate.top - 115;
        bowl.style.transform = `translate(${x}px, ${y}px)`;
        if (Math.sqrt(x*x + y*y) > 160) { isDragging = false; forceOpen(); }
    };
    bowl.onpointerup = () => { isDragging = false; bowl.style.transform = 'translate(0,0)'; };

    window.onload = () => {
        const logged = localStorage.getItem('v6_logged');
        if(logged) {
            currentUser = JSON.parse(localStorage.getItem('v6_users'))[logged];
            if(!currentUser.usedCodes) currentUser.usedCodes = [];
            document.getElementById('auth-screen').style.display = 'none';
        } else document.getElementById('auth-screen').style.display = 'flex';
        setInterval(gameLoop, 1000);
    };
</script>
</body>
</html>